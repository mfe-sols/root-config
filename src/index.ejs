<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>System Platform</title>
  <script>
    document.documentElement.classList.add("mfe-shell-booting");
  </script>
  <meta name="importmap-type" use-injector />
  <!-- If you wish to turn off import-map-overrides for specific environments (prod), uncomment the line below -->
  <!-- More info at https://github.com/single-spa/import-map-overrides/blob/main/docs/configuration.md#domain-list -->
  <!-- <meta name="import-map-overrides-domains" content="denylist:prod.example.com" /> -->

  <!-- Shared dependencies go into this import map -->
  <script type="injector-importmap">
    {
      "imports": {
        "single-spa": "/vendor/single-spa.min.js"
      }
    }
  </script>
  <link rel="preload" href="/vendor/single-spa.min.js" as="script">
  <link rel="preload" href="/vendor/system.min.js" as="script">
  <link rel="preload" href="/vendor/import-map-overrides.js" as="script">
  <link rel="preload" href="/vendor/import-map-injector.js" as="script">
  <link rel="preload" href="/vendor/zone.umd.js" as="script">

  <!-- Add your organization's prod import map URL to this script's src  -->
  <!-- <script type="injector-importmap" src="/importmap.json"></script> -->

  <% if (isLocal) { %>
  <script type="systemjs-importmap">
    {
      "imports": {
        "@org/header-react": "//localhost:9012/org-header-react.js?v=<%= rootConfigCssVersion || '' %>",
        "@org/footer-react": "//localhost:9013/org-footer-react.js?v=<%= rootConfigCssVersion || '' %>",
        "@org/catalog": "//localhost:9001/org-catalog.js",
        "@org/profile-vue": "//localhost:9002/profile-vue.js",
        "@org/playground-react": "//localhost:9007/org-playground.js",
        "@org/checkout-angular": "//localhost:9003/main.js",
        "@org/auth-angular": "//localhost:9010/main.js",
        "@org/playground-vue": "//localhost:9006/playground-vue.js",
        "@org/playground-angular": "//localhost:9005/main.js",
        "@org/playground-svelte": "//localhost:9011/org-playground-svelte.js",
        "@org/dashboard-vue": "//localhost:9004/dashboard-vue.js",
        "@org/simple-vanilla": "//localhost:9009/org-simple-vanilla.js",
        "zone.js": "/vendor/zone.umd.js"
      }
    }
  </script>
  <script type="injector-importmap">
    {
      "imports": {
        "@org/root-config": "//localhost:9000/org-root-config.js",
        "@org/header-react": "//localhost:9012/org-header-react.js?v=<%= rootConfigCssVersion || '' %>",
        "@org/footer-react": "//localhost:9013/org-footer-react.js?v=<%= rootConfigCssVersion || '' %>",
        "@org/catalog": "//localhost:9001/org-catalog.js",
        "@org/profile-vue": "//localhost:9002/profile-vue.js",
        "@org/playground-react": "//localhost:9007/org-playground.js",
        "@org/checkout-angular": "//localhost:9003/main.js",
        "@org/auth-angular": "//localhost:9010/main.js",
        "@org/playground-vue": "//localhost:9006/playground-vue.js",
        "@org/playground-angular": "//localhost:9005/main.js",
        "@org/playground-vanilla": "//localhost:9008/org-playground-vanilla.js",
        "@org/playground-svelte": "//localhost:9011/org-playground-svelte.js",
        "@org/dashboard-vue": "//localhost:9004/dashboard-vue.js",
        "@org/simple-vanilla": "//localhost:9009/org-simple-vanilla.js"
      }
    }
  </script>
  <% } %>
  <% if (!isLocal) { %>
  <script type="systemjs-importmap" src="<%= process.env.IMPORTMAP_PROD_URL || '/importmap.prod.json' %>"></script>
  <% } %>
  <script type="systemjs-importmap">
    {
      "imports": {
        "@org/root-config": "/org-root-config.js"
      }
    }
  </script>
  <meta name="auth-base-url" content="<%= process.env.AUTH_BASE_URL || '' %>">

  <script src="/vendor/zone.umd.js" defer></script>
  <script src="/vendor/system.min.js" defer></script>
  <script src="/vendor/import-map-overrides.js" defer></script>
  <script src="/vendor/import-map-injector.js" defer></script>
  <link rel="stylesheet" href="/ui-kit.css?v=<%= deployAssetVersion || uiKitCssVersion || '' %>" />
  <link rel="stylesheet" href="/root-config.css?v=<%= deployAssetVersion || rootConfigCssVersion || '' %>" />

</head>
<body>
  <noscript>
    You need to enable JavaScript to run this app.
  </noscript>
  <div
    id="mfe-shell-loader"
    class="mfe-shell-loader"
    data-loader-variant="bagua"
    role="status"
    aria-live="polite"
    aria-label="Loading system"
  >
    <div class="mfe-shell-loader__spinner" aria-hidden="true">
      <svg class="mfe-shell-loader__bagua" viewBox="0 0 100 100" focusable="false" aria-hidden="true">
        <circle class="mfe-shell-loader__bagua-shape mfe-shell-loader__bagua-shape--light" cx="50" cy="50" r="50"></circle>
        <path
          class="mfe-shell-loader__bagua-shape mfe-shell-loader__bagua-shape--dark"
          d="M50 0
             A50 50 0 0 0 50 100
             A25 25 0 0 0 50 50
             A25 25 0 0 1 50 0
             Z"
          transform="translate(0 100) scale(1 -1)"
        ></path>
        <circle class="mfe-shell-loader__bagua-shape mfe-shell-loader__bagua-shape--light" cx="50" cy="25" r="8.333"></circle>
        <circle class="mfe-shell-loader__bagua-shape mfe-shell-loader__bagua-shape--dark" cx="50" cy="75" r="8.333"></circle>
        <circle
          class="mfe-shell-loader__bagua-stroke"
          cx="50"
          cy="50"
          r="49.65"
          fill="none"
          stroke-width="0.7"
        ></circle>
      </svg>
    </div>
    <span class="mfe-shell-loader__sr">Loading system</span>
  </div>
  <div class="mfe-float-buttons" id="mfe-float-buttons" aria-label="Quick controls">
    <div class="mfe-float-actions" id="mfe-float-actions" aria-hidden="true">
      <button
        class="mfe-playgrounds-fab ds-fab-control"
        id="mfe-playgrounds-fab"
        type="button"
        aria-label="Toggle playground drawer"
        title="Playgrounds"
      >
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" aria-hidden="true">
          <rect x="3" y="3" width="7" height="7" rx="2" stroke="currentColor" stroke-width="1.6"></rect>
          <rect x="14" y="3" width="7" height="7" rx="2" stroke="currentColor" stroke-width="1.6"></rect>
          <rect x="3" y="14" width="7" height="7" rx="2" stroke="currentColor" stroke-width="1.6"></rect>
          <rect x="14" y="14" width="7" height="7" rx="2" stroke="currentColor" stroke-width="1.6"></rect>
        </svg>
      </button>
      <button
        class="mfe-perf-fab ds-fab-control"
        id="mfe-perf-fab"
        type="button"
        aria-label="Toggle performance panel"
        title="Performance"
      >
        ðŸ“Š
      </button>
      <button
        type="button"
        class="ds-locale-toggle ds-fab-control"
        id="ds-locale-toggle"
        aria-label="Toggle language"
        title="Toggle language"
      >
        EN
      </button>
      <button
        class="ds-theme-toggle ds-fab-control"
        id="ds-theme-toggle"
        type="button"
        aria-label="Toggle theme"
        title="Toggle theme"
      >
        ðŸŒ™
      </button>
      <button
        class="ds-primary-color-btn ds-fab-control ds-fab-control--keep-open"
        id="ds-primary-color-btn"
        type="button"
        aria-label="Change primary color"
        title="Change primary color"
      >
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" aria-hidden="true">
          <path d="M8.5 15.5 4.9 11.9a2.8 2.8 0 1 1 4-4l3.6 3.6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          <path d="M14.2 9.8 19.1 5a2.8 2.8 0 1 1 4 4l-4.8 4.9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          <path d="m10.9 13.1 4 4a2.8 2.8 0 1 1-4 4l-4-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          <circle cx="18.8" cy="18.8" r="1.5" fill="currentColor"/>
        </svg>
      </button>
      <input
        id="ds-primary-color-input"
        class="ds-primary-color-input"
        type="color"
        value="#0f766e"
        aria-label="Primary color picker"
      />
    </div>
    <button
      class="mfe-float-toggle ds-fab-control"
      id="mfe-float-toggle"
      type="button"
      aria-label="Open quick controls"
      aria-expanded="false"
      aria-controls="mfe-float-actions"
      title="Open quick controls"
    >
      â€¢â€¢â€¢
    </button>
  </div>

   <section class="mfe-perf-panel" id="mfe-perf-panel">
    <div class="mfe-perf-header flex items-center justify-between gap-2">
      <span class="ds-h6">Performance</span>
      <button type="button" class="ds-btn ds-btn--ghost ds-btn--sm" id="mfe-perf-refresh">Refresh</button>
    </div>
    <div class="mfe-perf-list" id="mfe-perf-list">
      <div class="mfe-perf-item">
        <div>
          <div>Waiting for metricsâ€¦</div>
          <div class="mfe-perf-meta">No data yet</div>
        </div>
        <div class="mfe-perf-time">â€”</div>
      </div>
    </div>
  </section>
  <div class="mfe-playgrounds-backdrop" id="mfe-playgrounds-backdrop" aria-hidden="true"></div>
  <aside
    class="mfe-playgrounds-drawer mfe-app-card"
    id="mfe-playgrounds-drawer"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    aria-label="Playgrounds quick links"
  >
    <div class="mfe-app-card__header">
      <div class="mfe-app-card__title" data-i18n="playgroundsTitle">Playgrounds</div>
      <div class="mfe-playgrounds-drawer-actions">
        <div class="mfe-app-card__meta" data-i18n="playgroundsMeta">Quick links</div>
        <button
          type="button"
          class="mfe-playgrounds-close"
          id="mfe-playgrounds-close"
          aria-label="Close playground drawer"
          title="Close"
        >
          âœ•
        </button>
      </div>
    </div>
    <div class="mfe-app-card__body">
      <div class="mfe-playground-links">
        <a class="mfe-playground-link" href="/playground-angular" data-app-link="@org/playground-angular" data-i18n="playgroundAngular">Angular Playground</a>
        <a class="mfe-playground-link" href="/playground-react" data-app-link="@org/playground-react" data-i18n="playgroundReact">React Playground</a>
        <a class="mfe-playground-link" href="/playground-vue" data-app-link="@org/playground-vue" data-i18n="playgroundVue">Vue Playground</a>
        <a class="mfe-playground-link" href="/playground-vanilla" data-app-link="@org/playground-vanilla" data-i18n="playgroundVanilla">Vanilla Playground</a>
        <a class="mfe-playground-link" href="/playground-svelte" data-app-link="@org/playground-svelte" data-i18n="playgroundSvelte">Svelte Playground</a>
        <a class="mfe-playground-link" href="/auth/login" data-app-link="@org/auth-angular">Auth (Login)</a>
      </div>
    </div>
  </aside>
  <script>
    (function () {
      var root = document.documentElement;
      var loaderEl = document.getElementById("mfe-shell-loader");
      var loaderLabelEl = loaderEl ? loaderEl.querySelector(".mfe-shell-loader__sr") : null;
      var loaderTimeoutId = 0;
      var loaderClosed = false;
      var loaderRemoveDelayMs = 320;
      var bootStarted = false;
      var onFirstMount = hideLoader;
      var onAppChange = hideLoader;

      function clamp(value, min, max) {
        return Math.min(max, Math.max(min, value));
      }

      function toNumber(value, fallback) {
        var next = Number(value);
        return Number.isFinite(next) ? next : fallback;
      }

      function cssSupports(prop, value) {
        try {
          return !!(window.CSS && typeof window.CSS.supports === "function" && window.CSS.supports(prop, value));
        } catch (_err) {
          return false;
        }
      }

      function sanitizeCssColor(value) {
        if (typeof value !== "string") return "";
        var trimmed = value.trim();
        if (!trimmed || trimmed.length > 64) return "";
        if (/[;{}]/.test(trimmed)) return "";
        return cssSupports("color", trimmed) ? trimmed : "";
      }

      function toCssLength(value) {
        if (typeof value === "number" && Number.isFinite(value)) {
          return clamp(value, 16, 240) + "px";
        }
        if (typeof value !== "string") return "";
        var trimmed = value.trim();
        if (!trimmed || trimmed.length > 32) return "";
        if (/[;{}]/.test(trimmed)) return "";
        return cssSupports("width", trimmed) ? trimmed : "";
      }

      function setLoaderStyleVar(name, value) {
        if (!loaderEl || value == null || value === "") return;
        loaderEl.style.setProperty(name, String(value));
      }

      function applyLoaderConfig(config) {
        if (!loaderEl || !config || typeof config !== "object") return;

        var variant = typeof config.variant === "string" ? config.variant.trim().toLowerCase() : "";
        if (variant === "bagua" || variant === "ring") {
          loaderEl.setAttribute("data-loader-variant", variant);
        }

        var label = typeof config.label === "string" ? config.label.trim() : "";
        if (label) {
          loaderEl.setAttribute("aria-label", label);
          if (loaderLabelEl) loaderLabelEl.textContent = label;
        }

        var size = toCssLength(config.size);
        if (size) setLoaderStyleVar("--mfe-shell-loader-size", size);

        var speedMs = toNumber(config.speedMs, NaN);
        if (Number.isFinite(speedMs)) {
          setLoaderStyleVar("--mfe-shell-loader-speed", clamp(speedMs, 160, 5000) + "ms");
        }

        var accent = sanitizeCssColor(config.accent);
        if (accent) setLoaderStyleVar("--mfe-shell-loader-accent", accent);

        var accentStrong = sanitizeCssColor(config.accentStrong);
        if (accentStrong) setLoaderStyleVar("--mfe-shell-loader-accent-strong", accentStrong);

        var baguaLight = sanitizeCssColor(config.baguaLight);
        if (baguaLight) setLoaderStyleVar("--mfe-shell-loader-bagua-light", baguaLight);

        var baguaDark = sanitizeCssColor(config.baguaDark);
        if (baguaDark) setLoaderStyleVar("--mfe-shell-loader-bagua-dark", baguaDark);

        var baguaBorder = sanitizeCssColor(config.baguaBorder);
        if (baguaBorder) setLoaderStyleVar("--mfe-shell-loader-bagua-border", baguaBorder);

        var timeoutMs = toNumber(config.timeoutMs, NaN);
        if (Number.isFinite(timeoutMs)) {
          loaderRemoveDelayMs = clamp(toNumber(config.removeDelayMs, loaderRemoveDelayMs), 160, 5000);
          return clamp(timeoutMs, 800, 60000);
        }

        var removeDelayMs = toNumber(config.removeDelayMs, NaN);
        if (Number.isFinite(removeDelayMs)) {
          loaderRemoveDelayMs = clamp(removeDelayMs, 160, 5000);
        }
      }

      function setLoaderTimeout(ms) {
        if (loaderClosed) return;
        if (loaderTimeoutId) {
          window.clearTimeout(loaderTimeoutId);
        }
        loaderTimeoutId = window.setTimeout(hideLoader, ms);
      }

      function cleanupLoaderListeners() {
        window.removeEventListener("single-spa:first-mount", onFirstMount);
        window.removeEventListener("single-spa:app-change", onAppChange);
      }

      function hideLoader() {
        if (loaderClosed) return;
        loaderClosed = true;
        if (loaderTimeoutId) {
          window.clearTimeout(loaderTimeoutId);
          loaderTimeoutId = 0;
        }
        cleanupLoaderListeners();
        root.classList.remove("mfe-shell-booting");
        if (!loaderEl) return;
        loaderEl.classList.add("is-hidden");
        window.setTimeout(function () {
          if (loaderEl && loaderEl.parentNode) {
            loaderEl.parentNode.removeChild(loaderEl);
          }
        }, loaderRemoveDelayMs);
      }

      var loaderTimeoutMs = 8000;
      var runtimeLoaderConfig = window.__MFE_SHELL_LOADER_CONFIG__;
      var configuredTimeoutMs = applyLoaderConfig(runtimeLoaderConfig);
      if (Number.isFinite(configuredTimeoutMs)) {
        loaderTimeoutMs = configuredTimeoutMs;
      }

      if (window.mfeShellLoader && typeof window.mfeShellLoader === "object") {
        window.mfeShellLoader.hide = hideLoader;
        window.mfeShellLoader.configure = function (nextConfig) {
          var nextTimeoutMs = applyLoaderConfig(nextConfig);
          if (Number.isFinite(nextTimeoutMs) && !loaderClosed) {
            setLoaderTimeout(nextTimeoutMs);
          }
        };
      } else {
        window.mfeShellLoader = {
          hide: hideLoader,
          configure: function (nextConfig) {
            var nextTimeoutMs = applyLoaderConfig(nextConfig);
            if (Number.isFinite(nextTimeoutMs) && !loaderClosed) {
              setLoaderTimeout(nextTimeoutMs);
            }
          }
        };
      }

      setLoaderTimeout(loaderTimeoutMs);
      window.addEventListener("single-spa:first-mount", onFirstMount, { once: true });
      window.addEventListener("single-spa:app-change", onAppChange, { once: true });

      function importRootConfig() {
        if (window.System && window.System.import) {
          return window.System.import('@org/root-config').catch(function (error) {
            hideLoader();
            throw error;
          });
        }
        return import('@org/root-config').catch(function (error) {
          hideLoader();
          throw error;
        });
      }
      function bootImportRootConfig() {
        if (bootStarted) return;
        bootStarted = true;
        importRootConfig();
      }
      function start() {
        if (bootStarted) return;
        if (window.importMapInjector && window.importMapInjector.initPromise) {
          Promise.resolve(window.importMapInjector.initPromise)
            .then(bootImportRootConfig)
            .catch(function (error) {
              hideLoader();
              throw error;
            });
        } else {
          bootImportRootConfig();
        }
      }
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", start, { once: true });
      } else {
        start();
      }
    })();
  </script>
  <import-map-overrides-full show-when-local-storage="devtools" dev-libs></import-map-overrides-full>
</body>
</html>
